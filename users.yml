---
  - name: Create student user
    remote_user: root
    vars_files:
      - passwords.yml
    hosts: all
    tasks:
      - name: Create student user
        when: ansible_distribution == "Ubuntu"
        user:
          name: student
          comment: ASPP Student
          groups: adm, sudo
          password: "{{ student_password }}"
          shell: "/bin/bash"
        tags: remote

      - name: Create student user
        when: ansible_distribution == "Fedora"
        user:
          name: student
          comment: ASPP Student
          groups: adm, wheel
          password: "{{ student_password }}"
          shell: "/bin/bash"
        tags: remote

      - name: Set authorized key taken from file
        authorized_key:
          user: student
          state: present
          key: "{{ lookup('file', '~/.ssh/id_ecdsa_aspp.pub') }}"
          exclusive: no
        ignore_errors: yes
